sequenceDiagram
    actor Operatore
    participant UserAgent
    participant FE as FE_MyOperatore
    participant BFF as BFF_MyOperatore
    participant AUTH as P4PA_AUTH
    participant SelfCare

    Operatore ->> UserAgent: Accede al portale MyPay Operatore

    activate UserAgent
    note over Operatore, UserAgent: Privo di sessione valida
    UserAgent ->> FE: 
    activate FE
    FE -->> UserAgent: Redirect verso pagina di login
    deactivate FE

    UserAgent ->> BFF: Pagina di login
    activate BFF
    BFF -->> UserAgent: Redirect verso servizio di autenticazione
    deactivate BFF

    UserAgent ->> SelfCare: Pagina di login
    activate SelfCare
    note right of SelfCare: L'utente si autentica e accede<br />al prodotto "Piattaforma Unitaria"
    SelfCare -->> UserAgent: Redirect verso pagina di accettazione tokenExchange
    deactivate SelfCare

    UserAgent ->> AUTH: Consegna tokenExchange
    activate AUTH
    note right of AUTH: Valida tokenExchange
    AUTH ->> SelfCare: getInstitutionProductOperatores
    note over AUTH, SelfCare: recupero email
    AUTH -->> UserAgent: Redirect verso pagina di accettazione ID token
    deactivate AUTH

    UserAgent ->> FE: Consegna ID token
    activate FE
    FE ->> BFF: Consegna ID token
    activate BFF
    note right of BFF: Valida ID token
    BFF -->> FE: access token JWT
    deactivate BFF
    FE -->> UserAgent: 
    alt L'operatore ha spuntato la casella "Ricordami"
        note right of UserAgent: token di sessione persistito nel local storage
    else
    note right of UserAgent: token di sessione mantenuto in RAM
    end
    deactivate FE

    UserAgent -->> Operatore: 
    
    note over Operatore, UserAgent: Da adesso l'operatore potr√† navigare le pagine del FE